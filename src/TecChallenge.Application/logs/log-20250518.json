{"Timestamp":"2025-05-18T11:56:02.0213808-03:00","Level":"Error","MessageTemplate":"An unhandled exception has occurred while executing the request.","TraceId":"1fe72760b237dd116cd21e54dbc37a34","SpanId":"712a04d2dac2f912","Exception":"Microsoft.EntityFrameworkCore.DbUpdateConcurrencyException: The database operation was expected to affect 1 row(s), but actually affected 0 row(s); data may have been modified or deleted since entities were loaded. See https://go.microsoft.com/fwlink/?LinkId=527962 for information on understanding and handling optimistic concurrency exceptions.\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ThrowAggregateUpdateConcurrencyExceptionAsync(RelationalDataReader reader, Int32 commandIndex, Int32 expectedRowsAffected, Int32 rowsAffected, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 89\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 46\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 59\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 60\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.PurchaseGame(PurchaseGameRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 41\r\n   at lambda_method1192(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"EventId":{"Id":1,"Name":"UnhandledException"},"SourceContext":"Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware","RequestId":"0HNCM3EOO7O2M:0000000D","RequestPath":"/api/v1/transactions/purchase","ConnectionId":"0HNCM3EOO7O2M","ApplicationName":"tech-challenge-api","ThreadId":23,"ProcessId":19504,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T11:56:02.0970684-03:00","Level":"Error","MessageTemplate":"An error has occurred","TraceId":"1fe72760b237dd116cd21e54dbc37a34","SpanId":"712a04d2dac2f912","Exception":"Microsoft.EntityFrameworkCore.DbUpdateConcurrencyException: The database operation was expected to affect 1 row(s), but actually affected 0 row(s); data may have been modified or deleted since entities were loaded. See https://go.microsoft.com/fwlink/?LinkId=527962 for information on understanding and handling optimistic concurrency exceptions.\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ThrowAggregateUpdateConcurrencyExceptionAsync(RelationalDataReader reader, Int32 commandIndex, Int32 expectedRowsAffected, Int32 rowsAffected, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 89\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 46\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 59\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 60\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.PurchaseGame(PurchaseGameRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 41\r\n   at lambda_method1192(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"SourceContext":"TecChallenge.Application.Extensions.GlobalExceptionHandler","RequestId":"0HNCM3EOO7O2M:0000000D","RequestPath":"/api/v1/transactions/purchase","ConnectionId":"0HNCM3EOO7O2M","ApplicationName":"tech-challenge-api","ThreadId":23,"ProcessId":19504,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T12:01:33.3951021-03:00","Level":"Error","MessageTemplate":"An unhandled exception has occurred while executing the request.","TraceId":"ba6f09230503717e3b2180b40c92b9f3","SpanId":"f700b90b9b85426e","Exception":"Microsoft.EntityFrameworkCore.DbUpdateConcurrencyException: The database operation was expected to affect 1 row(s), but actually affected 0 row(s); data may have been modified or deleted since entities were loaded. See https://go.microsoft.com/fwlink/?LinkId=527962 for information on understanding and handling optimistic concurrency exceptions.\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ThrowAggregateUpdateConcurrencyExceptionAsync(RelationalDataReader reader, Int32 commandIndex, Int32 expectedRowsAffected, Int32 rowsAffected, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 89\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 46\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 59\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 60\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.PurchaseGame(PurchaseGameRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 41\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"EventId":{"Id":1,"Name":"UnhandledException"},"SourceContext":"Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware","RequestId":"0HNCM3JFJE495:00000003","RequestPath":"/api/v1/transactions/purchase","ConnectionId":"0HNCM3JFJE495","ApplicationName":"tech-challenge-api","ThreadId":18,"ProcessId":8392,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T12:01:33.4700026-03:00","Level":"Error","MessageTemplate":"An error has occurred","TraceId":"ba6f09230503717e3b2180b40c92b9f3","SpanId":"f700b90b9b85426e","Exception":"Microsoft.EntityFrameworkCore.DbUpdateConcurrencyException: The database operation was expected to affect 1 row(s), but actually affected 0 row(s); data may have been modified or deleted since entities were loaded. See https://go.microsoft.com/fwlink/?LinkId=527962 for information on understanding and handling optimistic concurrency exceptions.\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ThrowAggregateUpdateConcurrencyExceptionAsync(RelationalDataReader reader, Int32 commandIndex, Int32 expectedRowsAffected, Int32 rowsAffected, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 89\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 46\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 59\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 60\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.PurchaseGame(PurchaseGameRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 41\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"SourceContext":"TecChallenge.Application.Extensions.GlobalExceptionHandler","RequestId":"0HNCM3JFJE495:00000003","RequestPath":"/api/v1/transactions/purchase","ConnectionId":"0HNCM3JFJE495","ApplicationName":"tech-challenge-api","ThreadId":18,"ProcessId":8392,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T12:17:40.4153060-03:00","Level":"Error","MessageTemplate":"Failed executing DbCommand ({elapsed}ms) [Parameters=[{parameters}], CommandType='{commandType}', CommandTimeout='{commandTimeout}']{newLine}{commandText}","TraceId":"1ee8dca44932cc3f07b4819af5917b9a","SpanId":"a6c12fcf76b34bfd","Properties":{"elapsed":"13","parameters":"@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p3='?' (DbType = DateTime2), @p4='?' (DbType = Guid), @p7='?' (DbType = Guid), @p5='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p6='?' (DbType = Guid), @p8='?' (DbType = Guid), @p9='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p10='?' (DbType = DateTime2), @p11='?' (Size = 100) (DbType = AnsiString), @p12='?' (DbType = Guid), @p13='?' (DbType = Guid), @p14='?' (DbType = Int32), @p15='?' (DbType = Guid)","commandType":"Text","commandTimeout":30,"newLine":"\r\n","commandText":"SET NOCOUNT ON;\r\nINSERT INTO [LibraryItem] ([Id], [GameId], [PurchasePrice], [PurchasedAt], [UserLibraryId])\r\nVALUES (@p0, @p1, @p2, @p3, @p4);\r\nUPDATE [UserWallet] SET [Balance] = @p5, [UserId] = @p6\r\nOUTPUT 1\r\nWHERE [Id] = @p7;\r\nINSERT INTO [WalletTransaction] ([Id], [Amount], [CreatedAt], [Description], [GameId], [PromotionGameId], [Type], [WalletId])\r\nVALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);","EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"ce5527ce-e406-41b4-a7f1-1e2bdca47f31","ActionName":"TecChallenge.Application.V1.Controllers.TransactionController.PurchaseGame (TecChallenge.Application)","RequestId":"0HNCM3SDK5RUM:00000003","RequestPath":"/api/v1/transactions/purchase","ConnectionId":"0HNCM3SDK5RUM","ApplicationName":"tech-challenge-api","ThreadId":15,"ProcessId":1584,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T12:17:40.5155236-03:00","Level":"Error","MessageTemplate":"An exception occurred in the database while saving changes for context type '{contextType}'.{newline}{error}","TraceId":"1ee8dca44932cc3f07b4819af5917b9a","SpanId":"a6c12fcf76b34bfd","Exception":"Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.\r\n ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_LibraryItem_UserLibrary_UserLibraryId\". The conflict occurred in database \"TechChallenge\", table \"dbo.UserLibrary\", column 'Id'.\r\nThe statement has been terminated.\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\nClientConnectionId:85ffcc28-a9c5-4f86-a507-f060d1ac238a\r\nError Number:547,State:0,Class:16\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)","Properties":{"contextType":"TecChallenge.Data.Contexts.AppDbContext","newline":"\r\n","error":"Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.\r\n ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_LibraryItem_UserLibrary_UserLibraryId\". The conflict occurred in database \"TechChallenge\", table \"dbo.UserLibrary\", column 'Id'.\r\nThe statement has been terminated.\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\nClientConnectionId:85ffcc28-a9c5-4f86-a507-f060d1ac238a\r\nError Number:547,State:0,Class:16\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)","EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"ce5527ce-e406-41b4-a7f1-1e2bdca47f31","ActionName":"TecChallenge.Application.V1.Controllers.TransactionController.PurchaseGame (TecChallenge.Application)","RequestId":"0HNCM3SDK5RUM:00000003","RequestPath":"/api/v1/transactions/purchase","ConnectionId":"0HNCM3SDK5RUM","ApplicationName":"tech-challenge-api","ThreadId":18,"ProcessId":1584,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T12:17:41.0336695-03:00","Level":"Error","MessageTemplate":"An unhandled exception has occurred while executing the request.","TraceId":"1ee8dca44932cc3f07b4819af5917b9a","SpanId":"a6c12fcf76b34bfd","Exception":"Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.\r\n ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_LibraryItem_UserLibrary_UserLibraryId\". The conflict occurred in database \"TechChallenge\", table \"dbo.UserLibrary\", column 'Id'.\r\nThe statement has been terminated.\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\nClientConnectionId:85ffcc28-a9c5-4f86-a507-f060d1ac238a\r\nError Number:547,State:0,Class:16\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 86\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 47\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 60\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 61\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.PurchaseGame(PurchaseGameRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 41\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"EventId":{"Id":1,"Name":"UnhandledException"},"SourceContext":"Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware","RequestId":"0HNCM3SDK5RUM:00000003","RequestPath":"/api/v1/transactions/purchase","ConnectionId":"0HNCM3SDK5RUM","ApplicationName":"tech-challenge-api","ThreadId":18,"ProcessId":1584,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T12:17:41.0576671-03:00","Level":"Error","MessageTemplate":"An error has occurred","TraceId":"1ee8dca44932cc3f07b4819af5917b9a","SpanId":"a6c12fcf76b34bfd","Exception":"Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.\r\n ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_LibraryItem_UserLibrary_UserLibraryId\". The conflict occurred in database \"TechChallenge\", table \"dbo.UserLibrary\", column 'Id'.\r\nThe statement has been terminated.\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\nClientConnectionId:85ffcc28-a9c5-4f86-a507-f060d1ac238a\r\nError Number:547,State:0,Class:16\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 86\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 47\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 60\r\n   at TecChallenge.Domain.Services.TransactionService.ProcessPurchaseAsync(Guid userId, Guid gameId, Nullable`1 promotionGameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 61\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.PurchaseGame(PurchaseGameRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 41\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"SourceContext":"TecChallenge.Application.Extensions.GlobalExceptionHandler","RequestId":"0HNCM3SDK5RUM:00000003","RequestPath":"/api/v1/transactions/purchase","ConnectionId":"0HNCM3SDK5RUM","ApplicationName":"tech-challenge-api","ThreadId":18,"ProcessId":1584,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T12:54:57.9935414-03:00","Level":"Error","MessageTemplate":"An unhandled exception has occurred while executing the request.","TraceId":"125a00ce9c02cdde8ee54de1c4af3375","SpanId":"8102d2258c9f3054","Exception":"System.InvalidOperationException: The association between entity types 'UserLibrary' and 'LibraryItem' has been severed, but the relationship is either marked as required or is implicitly required because the foreign key is not nullable. If the dependent/child entity should be deleted when a required relationship is severed, configure the relationship to use cascade deletes. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the key values.\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleConceptualNulls(Boolean sensitiveLoggingEnabled, Boolean force, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleNullForeignKey(IProperty property, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete, CurrentValueType valueType)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.set_Item(IPropertyBase propertyBase, Object value)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.ConditionallyNullForeignKeyProperties(InternalEntityEntry dependentEntry, InternalEntityEntry principalEntry, IForeignKey foreignKey)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectNavigationChange(InternalEntityEntry entry, INavigationBase navigationBase)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.LocalDetectChanges(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectChanges(IStateManager stateManager)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.TryDetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.Entries()\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 46\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 89\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 101\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 102\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.RefundedPurchase(RefundPurchaseRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 71\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"EventId":{"Id":1,"Name":"UnhandledException"},"SourceContext":"Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware","RequestId":"0HNCM4HAQ81B0:00000001","RequestPath":"/api/v1/transactions/refund-purchase","ConnectionId":"0HNCM4HAQ81B0","ApplicationName":"tech-challenge-api","ThreadId":15,"ProcessId":11244,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T12:54:58.0844097-03:00","Level":"Error","MessageTemplate":"An error has occurred","TraceId":"125a00ce9c02cdde8ee54de1c4af3375","SpanId":"8102d2258c9f3054","Exception":"System.InvalidOperationException: The association between entity types 'UserLibrary' and 'LibraryItem' has been severed, but the relationship is either marked as required or is implicitly required because the foreign key is not nullable. If the dependent/child entity should be deleted when a required relationship is severed, configure the relationship to use cascade deletes. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the key values.\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleConceptualNulls(Boolean sensitiveLoggingEnabled, Boolean force, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleNullForeignKey(IProperty property, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete, CurrentValueType valueType)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.set_Item(IPropertyBase propertyBase, Object value)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.ConditionallyNullForeignKeyProperties(InternalEntityEntry dependentEntry, InternalEntityEntry principalEntry, IForeignKey foreignKey)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectNavigationChange(InternalEntityEntry entry, INavigationBase navigationBase)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.LocalDetectChanges(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectChanges(IStateManager stateManager)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.TryDetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.Entries()\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 46\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 89\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 101\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 102\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.RefundedPurchase(RefundPurchaseRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 71\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"SourceContext":"TecChallenge.Application.Extensions.GlobalExceptionHandler","RequestId":"0HNCM4HAQ81B0:00000001","RequestPath":"/api/v1/transactions/refund-purchase","ConnectionId":"0HNCM4HAQ81B0","ApplicationName":"tech-challenge-api","ThreadId":15,"ProcessId":11244,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T13:05:12.8849222-03:00","Level":"Error","MessageTemplate":"An unhandled exception has occurred while executing the request.","TraceId":"9c27eb08db4d575450a9f8943a881898","SpanId":"032c4f023054b1f0","Exception":"System.InvalidOperationException: The association between entity types 'UserLibrary' and 'LibraryItem' has been severed, but the relationship is either marked as required or is implicitly required because the foreign key is not nullable. If the dependent/child entity should be deleted when a required relationship is severed, configure the relationship to use cascade deletes. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the key values.\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleConceptualNulls(Boolean sensitiveLoggingEnabled, Boolean force, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleNullForeignKey(IProperty property, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete, CurrentValueType valueType)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.set_Item(IPropertyBase propertyBase, Object value)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.ConditionallyNullForeignKeyProperties(InternalEntityEntry dependentEntry, InternalEntityEntry principalEntry, IForeignKey foreignKey)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectNavigationChange(InternalEntityEntry entry, INavigationBase navigationBase)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.LocalDetectChanges(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectChanges(IStateManager stateManager)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.TryDetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.Entries()\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 46\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 96\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 108\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 109\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.RefundedPurchase(RefundPurchaseRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 71\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"EventId":{"Id":1,"Name":"UnhandledException"},"SourceContext":"Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware","RequestId":"0HNCM4N1I4O9G:00000003","RequestPath":"/api/v1/transactions/refund-purchase","ConnectionId":"0HNCM4N1I4O9G","ApplicationName":"tech-challenge-api","ThreadId":10,"ProcessId":20152,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T13:05:12.9586070-03:00","Level":"Error","MessageTemplate":"An error has occurred","TraceId":"9c27eb08db4d575450a9f8943a881898","SpanId":"032c4f023054b1f0","Exception":"System.InvalidOperationException: The association between entity types 'UserLibrary' and 'LibraryItem' has been severed, but the relationship is either marked as required or is implicitly required because the foreign key is not nullable. If the dependent/child entity should be deleted when a required relationship is severed, configure the relationship to use cascade deletes. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the key values.\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleConceptualNulls(Boolean sensitiveLoggingEnabled, Boolean force, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleNullForeignKey(IProperty property, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete, CurrentValueType valueType)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.set_Item(IPropertyBase propertyBase, Object value)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.ConditionallyNullForeignKeyProperties(InternalEntityEntry dependentEntry, InternalEntityEntry principalEntry, IForeignKey foreignKey)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectNavigationChange(InternalEntityEntry entry, INavigationBase navigationBase)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.LocalDetectChanges(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectChanges(IStateManager stateManager)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.TryDetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.Entries()\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 46\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 96\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 108\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 109\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.RefundedPurchase(RefundPurchaseRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 71\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"SourceContext":"TecChallenge.Application.Extensions.GlobalExceptionHandler","RequestId":"0HNCM4N1I4O9G:00000003","RequestPath":"/api/v1/transactions/refund-purchase","ConnectionId":"0HNCM4N1I4O9G","ApplicationName":"tech-challenge-api","ThreadId":10,"ProcessId":20152,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T13:07:35.9133324-03:00","Level":"Error","MessageTemplate":"An unhandled exception has occurred while executing the request.","TraceId":"04b056472e196a6df0d877aaa68de0cb","SpanId":"71041798a7452943","Exception":"System.InvalidOperationException: The association between entity types 'UserLibrary' and 'LibraryItem' has been severed, but the relationship is either marked as required or is implicitly required because the foreign key is not nullable. If the dependent/child entity should be deleted when a required relationship is severed, configure the relationship to use cascade deletes. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the key values.\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleConceptualNulls(Boolean sensitiveLoggingEnabled, Boolean force, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleNullForeignKey(IProperty property, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete, CurrentValueType valueType)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.set_Item(IPropertyBase propertyBase, Object value)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.ConditionallyNullForeignKeyProperties(InternalEntityEntry dependentEntry, InternalEntityEntry principalEntry, IForeignKey foreignKey)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectNavigationChange(InternalEntityEntry entry, INavigationBase navigationBase)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.LocalDetectChanges(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectChanges(IStateManager stateManager)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.TryDetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.Entries()\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 46\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 96\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 108\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 109\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.RefundedPurchase(RefundPurchaseRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 71\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"EventId":{"Id":1,"Name":"UnhandledException"},"SourceContext":"Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware","RequestId":"0HNCM4OBV36PE:00000003","RequestPath":"/api/v1/transactions/refund-purchase","ConnectionId":"0HNCM4OBV36PE","ApplicationName":"tech-challenge-api","ThreadId":10,"ProcessId":18116,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T13:07:35.9950040-03:00","Level":"Error","MessageTemplate":"An error has occurred","TraceId":"04b056472e196a6df0d877aaa68de0cb","SpanId":"71041798a7452943","Exception":"System.InvalidOperationException: The association between entity types 'UserLibrary' and 'LibraryItem' has been severed, but the relationship is either marked as required or is implicitly required because the foreign key is not nullable. If the dependent/child entity should be deleted when a required relationship is severed, configure the relationship to use cascade deletes. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the key values.\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleConceptualNulls(Boolean sensitiveLoggingEnabled, Boolean force, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.HandleNullForeignKey(IProperty property, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete, CurrentValueType valueType)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.set_Item(IPropertyBase propertyBase, Object value)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.ConditionallyNullForeignKeyProperties(InternalEntityEntry dependentEntry, InternalEntityEntry principalEntry, IForeignKey foreignKey)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.NavigationCollectionChanged(InternalEntityEntry entry, INavigationBase navigationBase, IEnumerable`1 added, IEnumerable`1 removed)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectNavigationChange(InternalEntityEntry entry, INavigationBase navigationBase)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.LocalDetectChanges(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectChanges(IStateManager stateManager)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.TryDetectChanges()\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.Entries()\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 46\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 30\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 37\r\n   at TecChallenge.Data.UnitOfWork.UnitOfWork.CommitAsync(CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\UnitOfWork\\UnitOfWork.cs:line 42\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 96\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 108\r\n   at TecChallenge.Domain.Services.TransactionService.RefundedPurchaseAsync(Guid userId, Guid gameId, CancellationToken ct) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Domain\\Services\\TransactionService.cs:line 109\r\n   at TecChallenge.Application.V1.Controllers.TransactionController.RefundedPurchase(RefundPurchaseRequest request) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\V1\\Controllers\\TransactionController.cs:line 71\r\n   at lambda_method315(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)","Properties":{"SourceContext":"TecChallenge.Application.Extensions.GlobalExceptionHandler","RequestId":"0HNCM4OBV36PE:00000003","RequestPath":"/api/v1/transactions/refund-purchase","ConnectionId":"0HNCM4OBV36PE","ApplicationName":"tech-challenge-api","ThreadId":10,"ProcessId":18116,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T13:38:03.5600628-03:00","Level":"Error","MessageTemplate":"Failed executing DbCommand ({elapsed}ms) [Parameters=[{parameters}], CommandType='{commandType}', CommandTimeout='{commandTimeout}']{newLine}{commandText}","Properties":{"elapsed":"5","parameters":"@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Guid), @p3='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p4='?' (DbType = Guid)","commandType":"Text","commandTimeout":30,"newLine":"\r\n","commandText":"SET NOCOUNT ON;\r\nINSERT INTO [UserLibrary] ([Id], [UserId])\r\nVALUES (@p0, @p1);\r\nINSERT INTO [UserWallet] ([Id], [Balance], [UserId])\r\nVALUES (@p2, @p3, @p4);","EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ApplicationName":"tech-challenge-api","ThreadId":15,"ProcessId":10184,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T13:38:03.6234912-03:00","Level":"Error","MessageTemplate":"An exception occurred in the database while saving changes for context type '{contextType}'.{newline}{error}","Exception":"Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.\r\n ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'UserLibrary'.\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\nClientConnectionId:3d809c5b-2cd3-4856-bd23-8dd54142b177\r\nError Number:208,State:1,Class:16\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)","Properties":{"contextType":"TecChallenge.Data.Contexts.AppDbContext","newline":"\r\n","error":"Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.\r\n ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'UserLibrary'.\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\nClientConnectionId:3d809c5b-2cd3-4856-bd23-8dd54142b177\r\nError Number:208,State:1,Class:16\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)","EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ApplicationName":"tech-challenge-api","ThreadId":15,"ProcessId":10184,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T13:38:03.9235702-03:00","Level":"Error","MessageTemplate":"Erro ao inicializar banco de dados do Identity","Exception":"Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.\r\n ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'UserLibrary'.\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\nClientConnectionId:3d809c5b-2cd3-4856-bd23-8dd54142b177\r\nError Number:208,State:1,Class:16\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at TecChallenge.Data.Contexts.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Data\\Contexts\\AppDbContext.cs:line 68\r\n   at TecChallenge.Application.Data.DbInitializer.SeedUsers(AppDbContext context, UserManager`1 userManager) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\Data\\DbInitializer.cs:line 81\r\n   at TecChallenge.Application.Data.DbInitializer.Initialize(AppDbContext appDbContext, AuthDbContext authDbContext, UserManager`1 userManager, RoleManager`1 roleManager) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\Data\\DbInitializer.cs:line 26\r\n   at TecChallenge.Application.Configurations.IdentityConfig.InitializeIdentityDatabase(IApplicationBuilder app) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\Configurations\\IdentityConfiguration.cs:line 106","Properties":{"SourceContext":"Program","ApplicationName":"tech-challenge-api","ThreadId":15,"ProcessId":10184,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
{"Timestamp":"2025-05-18T22:03:25.9445837-03:00","Level":"Error","MessageTemplate":"Erro ao inicializar banco de dados do Identity","Exception":"System.InvalidOperationException: An error was generated for warning 'Microsoft.EntityFrameworkCore.Migrations.PendingModelChangesWarning': The model for context 'AppDbContext' has pending changes. Add a new migration before updating the database. See https://aka.ms/efcore-docs-pending-changes. This exception can be suppressed or logged by passing event ID 'RelationalEventId.PendingModelChangesWarning' to the 'ConfigureWarnings' method in 'DbContext.OnConfiguring' or 'AddDbContext'.\r\n   at Microsoft.EntityFrameworkCore.Diagnostics.EventDefinition`1.Log[TLoggerCategory](IDiagnosticsLogger`1 logger, TParam arg)\r\n   at Microsoft.EntityFrameworkCore.Diagnostics.RelationalLoggerExtensions.PendingModelChangesWarning(IDiagnosticsLogger`1 diagnostics, Type contextType)\r\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.ValidateMigrations(Boolean useTransaction, String targetMigration)\r\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)\r\n   at TecChallenge.Application.Data.DbInitializer.Initialize(AppDbContext appDbContext, AuthDbContext authDbContext, UserManager`1 userManager, RoleManager`1 roleManager) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\Data\\DbInitializer.cs:line 17\r\n   at TecChallenge.Application.Configurations.IdentityConfig.InitializeIdentityDatabase(IApplicationBuilder app) in C:\\Users\\kyo1506\\Documents\\Projects\\tec-challenge-fase-1\\src\\TecChallenge.Application\\Configurations\\IdentityConfiguration.cs:line 106","Properties":{"SourceContext":"Program","ApplicationName":"tech-challenge-api","ThreadId":10,"ProcessId":6240,"MachineName":"DESKTOP-VKOOU6T","EnvironmentName":"Development"}}
